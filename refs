# Stable Diffusion 2.1

# install git-lfs

curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | sudo bash
sudo apt-get install git-lfs
sudo -u ubuntu git lfs install --skip-smudge
sudo -u ubuntu git clone --depth 1 https://huggingface.co/stabilityai/stable-diffusion-2-1-base
cd stable-diffusion-2-1-base/
sudo -u ubuntu git lfs pull --include "v2-1_512-ema-pruned.ckpt"
sudo -u ubuntu git lfs install --force
sudo -u ubuntu git lfs install --skip-smudge
cd ..
mv stable-diffusion-2-1-base/v2-1_512-ema-pruned.ckpt stable-diffusion-webui/models/Stable-diffusion/
rm -rf stable-diffusion-2-1-base/
wget -O stable-diffusion-webui/models/Stable-diffusion/v2-1_512-ema-pruned.yaml https://raw.githubusercontent.com/Stability-AI/stablediffusion/main/configs/stable-diffusion/v2-inference.yaml

## Models

# wget https://huggingface.co/runwayml/stable-diffusion-v1-5/resolve/main/v1-5-pruned.ckpt -O /sdui/stable-diffusion-webui/models/Stable-diffusion/v1-5-pruned.ckpt

# wget https://huggingface.co/ckpt/sd15/resolve/main/v1-5-pruned-emaonly.ckpt -O /workspace/stable-diffusion-webui/models/Stable-diffusion/v1-5-pruned-emaonly.ckpt

# wget https://huggingface.co/ckpt/i15/resolve/main/sd-v1-5-inpainting.ckpt -O /workspace/stable-diffusion-webui/models/Stable-diffusion/sd-v1-5-inpainting.ckpt

curl -o /workspace/stable-diffusion-webui/models/Stable-diffusion/v1-5-pruned.ckpt -L https://huggingface.co/runwayml/stable-diffusion-v1-5/resolve/main/v1-5-pruned.ckpt

wget -O /workspace/stable-diffusion-webui/models/Stable-diffusion/anything-v4.5-pruned.ckpt https://huggingface.co/andite/anything-v4.0/resolve/main/anything-v4.5-pruned.ckpt
wget -O /workspace/stable-diffusion-webui/models/Stable-diffusion/anything-v4.5-pruned.vae.pt https://huggingface.co/andite/anything-v4.0/resolve/main/anything-v4.0.vae.pt

curl -o /workspace/stable-diffusion-webui/models/Stable-diffusion/mdjrny-v4.ckpt -L https://huggingface.co/prompthero/openjourney/resolve/main/mdjrny-v4.ckpt
curl -o /workspace/stable-diffusion-webui/models/Stable-diffusion/redshift-diffusion-v1.ckpt -L https://huggingface.co/nitrosocke/redshift-diffusion/resolve/main/redshift-diffusion-v1.ckpt

curl -o redshift-diffusion-v1.ckpt -L https://huggingface.co/nitrosocke/redshift-diffusion/resolve/main/redshift-diffusion-v1.ckpt

curl -o HassanBlend152Pruned.ckpt -L https://civitai.com/api/download/models/4378?type=Model&format=PickleTensor
curl -o /workspace/stable-diffusion-webui/models/Stable-diffusion/GTM_UltimateBlend_v3.ckpt -L https://civitai.com/api/download/models/5618?type=Model&format=PickleTensor
curl -o /workspace/stable-diffusion-webui/models/Stable-diffusion/GTM_UltimateBlend_inpainting_v3.ckpt -L https://civitai.com/api/download/models/6304?type=Model&format=PickleTensor

curl -o f222_v1.ckpt -L https://civitai.com/api/download/models/1224?type=Model&format=PickleTensor
curl -o /workspace/stable-diffusion-webui/models/Stable-diffusion/LibertyMain.ckpt -L https://civitai.com/api/download/models/6908?type=Model&format=PickleTensor
curl -o /workspace/stable-diffusion-webui/models/Stable-diffusion/LibertyMainInpaint.ckpt -L https://civitai.com/api/download/models/6937?type=Model&format=PickleTensor

curl -o /workspace/stable-diffusion-webui/models/Stable-diffusion/urpim.ckpt -L https://civitai.com/api/download/models/4971?type=Pruned%20Model&format=PickleTensor

curl -o /workspace/stable-diffusion-webui/models/Stable-diffusion/urpim.ckpt -L https://civitai.com/api/download/models/4971?type=Model&format=PickleTensor

//

curl -o /workspace/stable-diffusion-webui/models/Stable-diffusion/redshift-diffusion-v1.ckpt -L https://huggingface.co/nitrosocke/redshift-diffusion/blob/main/redshift-diffusion-v1.ckpt
curl -o /workspace/stable-diffusion-webui/models/Stable-diffusion/f222_v1.ckpt -L https://civitai.com/api/download/models/1224?type=Model&format=PickleTensor
curl -o LibertyMain.ckpt -L https://civitai.com/api/download/models/6908?type=Model&format=PickleTensor
curl -o /workspace/stable-diffusion-webui/models/Stable-diffusion/LibertyMainInpaint.ckpt -L https://civitai.com/api/download/models/6937?type=Model&format=PickleTensor
curl -o /workspace/stable-diffusion-webui/models/Stable-diffusion/LibertyTraining.ckpt -L https://civitai.com/api/download/models/6924?type=Model&format=PickleTensor

////// ACTUAL RUN SCRIPT

# # Install some example app

git clone https://github.com/AUTOMATIC1111/stable-diffusion-webui.git /workspace/stable-diffusion-webui
git clone https://github.com/deforum-art/deforum-for-automatic1111-webui.git /workspace/stable-diffusion-webui/extensions/deforum-for-automatic1111-webui
git clone https://github.com/d8ahazard/sd_dreambooth_extension.git /workspace/stable-diffusion-webui/extensions/sd_dreambooth_extension
git clone https://github.com/yfszzx/stable-diffusion-webui-images-browser /workspace/stable-diffusion-webui/extensions/stable-diffusion-webui-images-browser
git clone https://github.com/camenduru/stable-diffusion-webui-huggingface /workspace/stable-diffusion-webui/extensions/stable-diffusion-webui-huggingface
git clone https://github.com/camenduru/sd-civitai-browser.git /workspace/stable-diffusion-webui/extensions/sd-civitai-browser
git clone https://github.com/camenduru/sd-webui-additional-networks /workspace/stable-diffusion-webui/extensions/sd-webui-additional-networks
git clone https://github.com/AUTOMATIC1111/stable-diffusion-webui-promptgen.git /workspace/stable-diffusion-webui/extensions/stable-diffusion-webui-promptgen
git clone https://github.com/d8ahazard/sd_smartprocess.git /workspace/stable-diffusion-webui/extensions/sd_smartprocess

wget https://huggingface.co/ckpt/sd15/resolve/main/v1-5-pruned-emaonly.ckpt -O v1-5-pruned-emaonly.ckpt
wget https://huggingface.co/ckpt/i15/resolve/main/sd-v1-5-inpainting.ckpt -O /workspace/stable-diffusion-webui/models/Stable-diffusion/sd-v1-5-inpainting.ckpt

# su ubuntu -c '/workspace/stable-diffusion-webui/webui.sh --xformers --disable-console-progressbars > /workspace/stable-diffusion-webui/exec_log.out'

curl -o /workspace/stable-diffusion-webui/models/Stable-diffusion/v1-5-pruned.ckpt -L https://huggingface.co/ckpt/sd15/resolve/main/v1-5-pruned.ckpt

touch /workspace/log/exec_log.out
chown -R ubuntu /workspace/stable-diffusion-webui

# su ubuntu -c 'REQS_FILE=/workspace/stable-diffusion-webui/extensions/sd_dreambooth_extension/requirements.txt nohup /workspace/stable-diffusion-webui/webui.sh --xformers --disable-console-progressbars > /workspace/stable-diffusion-webui/exec_log.out &'

stable-diffusion-webui/webui.sh --xformers --disable-console-progressbars --gradio-auth dragon:ballz
